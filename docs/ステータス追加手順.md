# 新ステータス追加とステ振り実装手順

## 概要

このドキュメントでは、マインクラフトMODに新しいステータス（例：技術）を追加し、ステ振り機能を実装するまでの手順を説明します。

## 前提条件

- 基本的なForge MOD開発環境が構築済み
- 既存のステータス（筋力）が実装済み
- キーバインドとGUI画面が動作している状態

---

## 手順1: ステータス種別の定義

### 1.1 StatTypeの拡張

新しいステータス種別を列挙型に追加します。  
適した名称で登録してください。

**対象ファイル：** `StatType.java`

```java
// TechniqueをStatType.javaに追加
TECHNIQUE("technique", "技術")
```

---

## 手順2: ステータスインターフェースと実装クラス

### 2.1 インターフェース作成

新ステータス用のインターフェースを定義します。

**参考ファイル：** `IStrength.java`  
**新規作成ファイル：** `ITechnique.java`

### 2.2 実装クラス作成

インターフェースの具象クラスを作成します。

**参考ファイル：** `Strength.java`  
**新規作成ファイル：** `Technique.java`

### 2.3 Capabilityプロバイダー作成

プレイヤーにステータスをアタッチするためのプロバイダーを作成します。

**参考ファイル：** `StrengthProvider.java`  
**新規作成ファイル：** `TechniqueProvider.java`

---

## 手順3: クライアント側ストレージ

### 3.1 クライアントサイドデータ管理

クライアント側でステータス値を保持・同期するクラスを作成します。

**参考ファイル：** `ClientStrengthStorage.java`  
**新規作成ファイル：** `ClientTechniqueStorage.java`

実装内容：
- ステータス値の保持（`clientTechnique`）
- getter/setterメソッド
- サーバーとの同期機能

---

## 手順4: ネットワーク通信

### 4.1 同期パケット作成

サーバーからクライアントへのステータス同期パケットを作成します。

**参考ファイル：** `StrengthSyncPacket.java`  
**新規作成ファイル：** `TechniqueSyncPacket.java`

### 4.2 ステータスアップリクエストパケット

既存の`StatUpRequestPacket.java`を確認し、新しいステータス種別に対応済みか検証します。

**対象ファイル：** `StatUpRequestPacket.java`

---

## 手順5: サーバーサイド処理

### 5.1 イベントハンドラー拡張

プレイヤー接続時・復活時・ディメンション移動時の処理を拡張します。

**対象ファイル：** `CapabilityEventHandler.java`

追加内容：
- `attachCapabilities`メソッドに`TechniqueProvider`を追加
- 各イベントでの同期処理追加

### 5.2 ステータスアップ処理

ステ振り時の処理ロジックを実装します。

**対象ファイル：** `StatUpRequestPacket.java`のhandleメソッド

---

## 手順6: GUI表示対応

### 6.1 統合画面での表示

ステ振りパネルに新しいステータスを表示します。

**対象ファイル：** `CombinedStatusLevelUpScreen.java`

修正箇所：
- `renderLevelUpPanel`メソッドでの表示ロジック
- `init`メソッドでのボタン生成ロジック
- ステータス値取得処理

### 6.2 ステータス効果の適用（未実装）

技術ステータスが他のゲーム要素に与える影響を実装します。

**実装例：**
- クラフト速度向上
- エンチャント成功率アップ
- 経験値獲得量増加

---

## 手順7: データの永続化

### 7.1 NBTデータ保存

プレイヤーデータとしてステータスを保存・読み込みます。

**対象ファイル：** `Technique.java`

実装メソッド：
- `saveNBTData`
- `loadNBTData`

---

## 手順8: 言語ファイル更新（未実装）

### 8.1 多言語対応

新しいステータス名を言語ファイルに追加します。

**対象ファイル：**
- `assets/yourmod/lang/en_us.json`
- `assets/yourmod/lang/ja_jp.json`

追加内容：
```json
{
  "stat.yourmod.technique": "Technique",
  "stat.yourmod.technique.description": "Improves crafting and enchanting"
}
```

---

## 手順9: テストとデバッグ

### 9.1 機能テスト項目

- [ ] ステータス初期値の設定確認
- [ ] ステ振りボタンの動作確認
- [ ] 経験値消費の正常動作
- [ ] サーバー・クライアント間の同期確認
- [ ] ワールド再読み込み時のデータ保持確認
- [ ] ゲーム再起動後のステータス保持確認
- [ ] マルチプレイでの動作確認

### 9.2 デバッグ用ログ（後で）

開発中はデバッグログを追加して動作を確認します。

```java
// 例：ステータス変更時のログ出力
AshenMod.LOGGER.info("Technique increased: {} -> {}", oldValue, newValue);
```

---

## 手順10: パフォーマンス最適化（後で）
### 10.1 同期頻度の最適化

不要な同期を避け、必要な場合のみパケット送信を行います。

### 10.2 クライアントキャッシュ

クライアント側でのデータキャッシュを適切に管理します。

---

## 注意事項

1. **既存コードとの整合性**  
   既存のステータス実装と同様のパターンを維持する

2. **バージョン互換性**  
   セーブデータの後方互換性を考慮した実装

3. **エラーハンドリング**  
   Capabilityが存在しない場合の適切な処理

4. **リソース管理**  
   不要なオブジェクト生成を避け、メモリリークを防止

---

## 実装完了後の確認

新しいステータスが正常に動作することを以下で確認：

1. ゲーム内でLキーを押下し、統合GUI画面が表示される
2. 技術ステータスが一覧に表示される  
3. 経験値を消費してステ振りができる
4. ステータス効果が適切に適用される
5. ワールド再読み込み後もデータが保持される

以上で新しいステータスの実装が完了です。